!function(i){i(document).on("sowsetupformfield",".siteorigin-widget-field-type-multiple_media",(function(e){var t=i(this),n=t.find(".siteorigin-widget-input"),d=n.val().split(","),a=n.data("repeater");t.data("initialized")||(a&&(a.field=t.siblings(".siteorigin-widget-field-"+a.field).find(" > .siteorigin-widget-field-repeater"),a.addBtn=a.field.find("> .siteorigin-widget-field-repeater-add")),t.find(".button").on("click",(function(e){if(e.preventDefault(),void 0!==wp.media){var l=i(this),r=i(this).data("frame");if(r)return r.open(),!1;r=wp.media({title:l.data("choose"),library:{type:l.data("library").split(",").map((function(i){return i.trim()}))},multiple:!0,button:{text:l.data("update"),close:!1}}),a||r.on("open",(function(){if(d.length){var e=r.state().get("selection");i.each(d,(function(){e.add(wp.media.attachment(this))}))}})),r.on("library:selection:add",(function(){wp.media.frame.content.get().collection._requery(!0),setTimeout((function(){wp.media.frame.content.get().collection._requery(!0)}),0)})),r.on("select",(function(){var e,l,o,f,s,m=[];i.each(r.state().get("selection").models,(function(){if(e=this.attributes,a)a.addBtn.trigger("click"),o=a.field.find("> .siteorigin-widget-field-repeater-items > .siteorigin-widget-field-repeater-item:last-of-type > .siteorigin-widget-field-repeater-item-form > .siteorigin-widget-field-"+a.setting),(s=o.find(".siteorigin-widget-input").not(".media-fallback-external")).val(e.id),o.find(".thumbnail").show();else{if(m.push(e.id),-1!=d.indexOf(e.id.toString()))return;t.find(".multiple-media-field-template .multiple-media-field-item").clone().appendTo(t.find(".multiple-media-field-items")),(o=t.find(".multiple-media-field-items .multiple-media-field-item").last()).attr("data-id",e.id)}(f=o.find(".thumbnail")).attr("title",e.title),o.find(".title").html(e.title),l=void 0!==e.sizes?void 0!==e.sizes.thumbnail?e.sizes.thumbnail.url:e.sizes.full.url:e.icon,f.attr("src",l),a&&s.trigger("change",{silent:!0})})),t.find(".multiple-media-field-items .multiple-media-field-item").each((function(){-1==m.indexOf(i(this).data("id"))&&i(this).remove()})),m.length?(d=m,n.val(m.join(","))):(d=[],n.val("")),r.close()})),l.data("frame",r),r.open()}})),a||t.on("click","a.media-remove-button",(function(e){e.preventDefault();var t=i(this).parent();d.splice(d.indexOf(t.data("id")),1),n.val(d.join(",")),t.remove()})),t.data("initialized",!0))}))}(jQuery);