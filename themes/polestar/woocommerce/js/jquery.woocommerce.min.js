jQuery(function(o){function i(i){var e=o(i),t=o("<div></div>").html('<span class="current">'+e.find(":selected").html()+"</span>"+polestar_data.chevron_down).addClass("ordering-selector-wrapper").insertAfter(e),r=o("<div/>").addClass("ordering-dropdown-container").appendTo(t),i=o("<ul></ul>").addClass("ordering-dropdown").appendTo(r),n=0;e.find("option").each(function(){var e=o(this);i.append(o("<li></li>").html(e.html()).data("val",e.attr("value"))),t.find(".current").html(e.html()),n=Math.max(t.find(".current").width(),n)}),t.find(".current").html(e.find(":selected").html()),t.find(".current").width(n),e.hide()}o(document).on("click",".ordering-selector-wrapper .ordering-dropdown li",function(){var e=o(this).parents(".polestar-variations-wrapper, .woocommerce-ordering").find("select");e.val(o(this).data("val")).trigger("change"),e.hasClass("woocommerce-ordering")?e.closest("form").trigger("submit"):($variations=o(this).parents(".variations")).length?$variations.find(".polestar-variations-wrapper").each(function(){var t=o(this).find(".ordering-dropdown");t.empty(),o(this).find("option").each(function(e){var i=o(this);t.append(o("<li></li>").html(i.html()).data("val",i.attr("value")))}),o(this).find(".current").text(o(this).find("select").find(":selected").text())}):o(this).parents(".ordering-selector-wrapper").find(".current").text(o(this).text())}),o(".woocommerce-ordering select, .polestar-variations-wrapper select").each(function(){i(this)}),o(document).on("click",".ordering-selector-wrapper",function(){o(".open-dropdown").removeClass("open-dropdown"),o(this).toggleClass("open-dropdown")}),o(window).on("click",function(e){o(e.target).closest(".ordering-selector-wrapper.open-dropdown").length||o(".ordering-selector-wrapper.open-dropdown").removeClass("open-dropdown")}),o(document).on("click",".woocommerce .product .variations .reset_variations",function(){o(this).parents(".variations_form").find(".polestar-variations-wrapper").each(function(){var e=o(this);e.find(".current").text(e.find(".ordering-dropdown li").first().text()),e.find("select").find(":selected").prop("selected",!1),e.find("select").trigger("change")})}),o(".product-quick-view-button").on("click",function(e){e.preventDefault();var t="#quick-view-container",r="#product-quick-view",e=o(this).attr("data-product-id");o.post(polestar_data.ajaxurl,{action:"polestar_product_quick_view",product_id:e},function(e){o(document).find(t).find(r).html(e),o(document).find("#product-quick-view .variations_form").wc_variation_form(),o(document).find("#product-quick-view .variations_form").trigger("check_variations"),o("#quick-view-container .polestar-variations-wrapper select").each(function(){i(this)})}),o(document).ajaxComplete(function(){o.isFunction(o.fn.flexslider)&&(o(".product-images-slider").flexslider({animation:"slide",customDirectionNav:o(this).find(".flex-direction-nav a"),start:function(){o(".flexslider .slides img").show()}}),o("#product-quick-view .variations_form").on("found_variation.wc-variation-form",function(e,i){i&&i.image&&i.image.full_src&&(0<(i=o("#product-quick-view .product-gallery-image").find('img[src="'+i.image.full_src+'"]')).length?o(".product-images-slider").flexslider(i.parent().index(".product-images-slider  .slide")-1):o(".product-images-slider").flexslider(0))}),o("#product-quick-view .variations_form").on("reset_image",function(e,i){o(".product-images-slider").flexslider(0)}))}),o(document).find(t).is(":hidden")&&o(document).find(t).find(r).empty(),o(document).find(t).fadeIn(300),o("body").css("margin-right",window.innerWidth-o("body").width()+"px"),o("body").css("overflow","hidden"),o(window).on("mouseup",function(e){var i=o(r);(!i.is(e.target)&&0===i.has(e.target).length||o(".quickview-close-icon").is(e.target))&&(o(t).fadeOut(300),o("body").css("overflow",""),o("body").css("margin-right",""))}),o(document).on("keyup",function(e){o(r);27==e.keyCode&&(o(t).fadeOut(300),o("body").css("overflow",""),o("body").css("margin-right",""))})})});